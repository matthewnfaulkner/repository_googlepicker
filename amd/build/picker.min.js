/**
 * Google picker js
 *
 * @copyright   2025 Matthew<matthewfaulkner@apoaevents.com>
 * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("repository_googlepicker/picker",["core/log","core/str"],(function(Log,String){return{init:function(token,apikey,appid,sesskey,secret,mimetypes){const APP_ID=appid,DEVELOPER_KEY=apikey,SESSKEY=sesskey,SECRET=secret,MIMETYPES=mimetypes;let oauthToken=token,pickerApiLoaded=!1;function pickerCallback(data){if(data.action===google.picker.Action.PICKED){const doc=data.docs[0];if(mimeType=doc.mimeType,!MIMETYPES.split(",").map((s=>s.trim())).includes(mimeType))return String.get_string("invalidfiletype","repository_googlepicker").done((function(s){window.parent.M.core_filepicker.active_filepicker.display_error(s)}));doc.exportformat="download",async function(input){const data=(new TextEncoder).encode(input),hashBuffer=await crypto.subtle.digest("SHA-1",data);return Array.from(new Uint8Array(hashBuffer)).map((b=>b.toString(16).padStart(2,"0"))).join("")}(JSON.stringify(doc)+SECRET+SESSKEY).then((function(hash){var resource={};resource.title=doc.name,resource.source=JSON.stringify(doc),resource.sourcekey=hash,resource.thumbnail=doc.iconUrl,resource.author="",resource.license="",window.parent.M.core_filepicker.select_file(resource)}))}var mimeType}gapi.load("picker",{callback:function(){pickerApiLoaded=!0,function(){if(pickerApiLoaded&&oauthToken){const view=(new google.picker.DocsView).setIncludeFolders(!0).setSelectFolderEnabled(!1);MIMETYPES&&view.setMimeTypes(MIMETYPES);(new google.picker.PickerBuilder).enableFeature(google.picker.Feature.NAV_HIDDEN).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setAppId(APP_ID).setOAuthToken(oauthToken).setDeveloperKey(DEVELOPER_KEY).addView(view).setCallback(pickerCallback).build().setVisible(!0)}}()}})}}}));

//# sourceMappingURL=picker.min.js.map